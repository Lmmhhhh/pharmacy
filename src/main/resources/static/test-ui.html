<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì•½êµ­ í†µí•© ì›¹ UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 30px; }
        pre { background: #f8f9fa; padding: 15px; border: 1px solid #ccc; border-radius: 5px; white-space: pre-wrap; }
        .section { margin-bottom: 60px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-5">ğŸ’Š ì•½êµ­ í†µí•© ì›¹ UI</h1>

    <!-- ì•½ ëª©ë¡ ì¡°íšŒ -->
    <div class="section">
        <h4>ğŸ“¦ ì•½ ëª©ë¡ ì¡°íšŒ</h4>
        <button class="btn btn-primary mb-2" onclick="loadDrugList()">ì¡°íšŒ</button>
        <table class="table table-bordered">
            <thead><tr><th>ì•½í’ˆ ID</th><th>ì•½í’ˆëª…</th><th>ì¬ê³ </th></tr></thead>
            <tbody id="drugTable"></tbody>
        </table>
    </div>

    <!-- ìœ í†µê¸°í•œ ì„ë°• ì•½í’ˆ ì¡°íšŒ -->
    <div class="section">
        <h4>â° ìœ í†µê¸°í•œ ì„ë°•</h4>
        <button class="btn btn-warning mb-2" onclick="loadExpiring()">ì¡°íšŒ</button>
        <table class="table">
            <thead><tr><th>ì•½í’ˆëª…</th><th>ìœ í†µê¸°í•œ</th><th>ì¬ê³ </th><th>ë‚¨ì€ ì¼ìˆ˜</th></tr></thead>
            <tbody id="expiringTable"></tbody>
        </table>
    </div>

    <!-- ì¼ë°˜ì•½ ì£¼ë¬¸ -->
    <div class="section">
        <h4>ğŸ›’ ì¼ë°˜ì•½ ì£¼ë¬¸</h4>
        <input class="form-control mb-2" id="otcName" placeholder="ì´ë¦„">
        <input class="form-control mb-2" id="otcPhone" placeholder="ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬">
        <input class="form-control mb-2" id="otcDrug" placeholder="ì•½í’ˆëª…">
        <input class="form-control mb-2" id="otcQty" type="number" placeholder="ìˆ˜ëŸ‰" value="1">
        <input class="form-control mb-2" id="otcDate" type="date">
        <button class="btn btn-success" onclick="orderOtc()">ì£¼ë¬¸</button>
        <pre id="otcResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- ì²˜ë°©ì•½ ì£¼ë¬¸ -->
    <div class="section">
        <h4>ğŸ§¾ ì²˜ë°©ì•½ ì¡°ì œ</h4>
        <input class="form-control mb-2" id="rxName" placeholder="ì´ë¦„">
        <input class="form-control mb-2" id="rxPhone" placeholder="ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬">
        <input class="form-control mb-2" id="rxBirth" type="date" placeholder="ìƒë…„ì›”ì¼">
        <input class="form-control mb-2" id="rxGender" placeholder="ì„±ë³„ (ë‚¨/ì—¬)">
        <input class="form-control mb-2" id="rxAddress" placeholder="ì£¼ì†Œ">
        <input class="form-control mb-2" id="rxAllergy" placeholder="ì•ŒëŸ¬ì§€ ì •ë³´">
        <input class="form-control mb-2" id="rxDoctor" placeholder="ì˜ì‚¬ëª…">
        <input class="form-control mb-2" id="rxHospital" placeholder="ë³‘ì›ëª…">
        <input class="form-control mb-2" id="rxIssuedDate" type="date" placeholder="ì²˜ë°©ì¼ì">
        <input class="form-control mb-2" id="rxSaleDate" type="date" placeholder="ì¡°ì œì¼ì">
        <textarea class="form-control mb-2" id="rxItemsJson" placeholder='ì•½í’ˆ JSON ë°°ì—´: [{"drugId":1,"quantity":2,"dosage":"1ì¼3íšŒ1ì •","medicGuide":"ì‹í›„"}]'></textarea>
        <button class="btn btn-success" onclick="orderPrescription()">ì¡°ì œ ì²˜ë¦¬</button>
        <pre id="rxResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- ì…ê³  ë“±ë¡ -->
    <div class="section">
        <h4>ğŸ“¥ ì…ê³  ë“±ë¡</h4>
        <input class="form-control mb-2" id="inDrug" placeholder="ì•½í’ˆëª…">
        <input class="form-control mb-2" id="inQty" type="number" placeholder="ìˆ˜ëŸ‰">
        <input class="form-control mb-2" id="inPrice" type="number" placeholder="ë‹¨ê°€">
        <input class="form-control mb-2" id="inDate" type="date" placeholder="ì…ê³ ì¼">
        <input class="form-control mb-2" id="inExpire" type="date" placeholder="ìœ í†µê¸°í•œ">
        <input class="form-control mb-2" id="inSupplier" placeholder="ê³µê¸‰ì²˜">
        <button class="btn btn-secondary" onclick="registerPurchase()">ë“±ë¡</button>
        <pre id="inResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- ë§¤ì¶œ í†µê³„ ì¡°íšŒ -->
    <div class="section">
        <h4>ğŸ“ˆ ì›”ê°„ ë§¤ì¶œ í†µê³„</h4>
        <input class="form-control mb-2" id="statYear" placeholder="ì—°ë„" value="2025">
        <input class="form-control mb-2" id="statMonth" placeholder="ì›”" value="6">
        <button class="btn btn-info" onclick="loadStats()">ì¡°íšŒ</button>
        <pre id="statResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- í™˜ì ë³µì•½ ì´ë ¥ ì¡°íšŒ -->
    <div class="section">
        <h4>ğŸ“ ë³µì•½ ì´ë ¥ ì¡°íšŒ</h4>
        <input class="form-control mb-2" id="histName" placeholder="ì´ë¦„">
        <input class="form-control mb-2" id="histPhone" placeholder="ì „í™”ë²ˆí˜¸ ë’· 4ìë¦¬">
        <button class="btn btn-dark" onclick="loadHistory()">ì¡°íšŒ</button>
        <pre id="histResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- ì¼ë°˜ì•½ ì£¼ë¬¸ ì·¨ì†Œ -->
    <div class="section">
        <h4>ğŸ—‘ ì¼ë°˜ì•½ ì£¼ë¬¸ ì·¨ì†Œ</h4>
        <input class="form-control mb-2" id="cancelOrderId" placeholder="order_drug_id ì…ë ¥">
        <button class="btn btn-danger" onclick="cancelOrder()">ì‚­ì œ</button>
        <pre id="cancelResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>

    <!-- ì•½í’ˆ í‚¤ì›Œë“œ ê²€ìƒ‰ -->
    <div class="section">
        <h4>ğŸ” ì•½í’ˆ ê²€ìƒ‰</h4>
        <input class="form-control mb-2" id="searchKeyword" placeholder="ì´ë¦„, ì œì¡°ì‚¬, íš¨ëŠ¥ ë“±">
        <button class="btn btn-outline-primary" onclick="searchDrug()">ê²€ìƒ‰</button>
        <pre id="searchResult" class="mt-3">- ê²°ê³¼ -</pre>
    </div>
</div>


<script>
    async function loadDrugList() {
      const res = await fetch("/view/drug-stock");
      const data = await res.json();
      const tbody = document.getElementById("drugTable");
      tbody.innerHTML = data.map(d => `<tr><td>${d.drug_id}</td><td>${d.drug_name}</td><td>${d.stock}</td></tr>`).join("");
    }

    async function loadExpiring() {
      const res = await fetch("/view/expiring");
      const data = await res.json();
      const tbody = document.getElementById("expiringTable");
      tbody.innerHTML = data.map(d => `<tr><td>${d.drug_name}</td><td>${d.expiration_date}</td><td>${d.remaining_quantity}</td><td>${d.days_left}</td></tr>`).join("");
    }

    async function orderOtc() {
      const payload = {
        name: document.getElementById("otcName").value,
        phoneLast4: document.getElementById("otcPhone").value,
        saleDate: document.getElementById("otcDate").value,
        items: [
          {
            drugName: document.getElementById("otcDrug").value,
            quantity: parseInt(document.getElementById("otcQty").value)
          }
        ]
      };
        async function orderPrescription() {
    const payload = {
      isPrescription: true,
      name: document.getElementById("rxName").value,
      phone: document.getElementById("rxPhone").value,
      birthDate: document.getElementById("rxBirth").value,
      gender: document.getElementById("rxGender").value,
      address: document.getElementById("rxAddress").value,
      allergy: document.getElementById("rxAllergy").value,
      doctor: document.getElementById("rxDoctor").value,
      hospital: document.getElementById("rxHospital").value,
      issuedDate: document.getElementById("rxIssuedDate").value,
      saleDate: document.getElementById("rxSaleDate").value,
      items: JSON.parse(document.getElementById("rxItemsJson").value)
    };

  async function orderPrescription() {
    const payload = {
      isPrescription: true,
      name: document.getElementById("rxName").value,
      phone: document.getElementById("rxPhone").value,
      birthDate: document.getElementById("rxBirth").value,
      gender: document.getElementById("rxGender").value,
      address: document.getElementById("rxAddress").value,
      allergy: document.getElementById("rxAllergy").value,
      doctor: document.getElementById("rxDoctor").value,
      hospital: document.getElementById("rxHospital").value,
      issuedDate: document.getElementById("rxIssuedDate").value,
      saleDate: document.getElementById("rxSaleDate").value,
      items: JSON.parse(document.getElementById("rxItemsJson").value)
    };

    const res = await fetch("/orders/prescription", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    document.getElementById("rxResult").textContent = JSON.stringify(result, null, 2);
  }

    const res = await fetch("/orders/prescription", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    document.getElementById("rxResult").textContent = JSON.stringify(result, null, 2);
  }

      const res = await fetch("/orders/otc", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const result = await res.json();
      document.getElementById("otcResult").textContent = JSON.stringify(result, null, 2);
    }

    async function loadStats() {
      const y = document.getElementById("statYear").value;
      const m = document.getElementById("statMonth").value;
      const res = await fetch(`/stats/monthly?year=${y}&month=${m}`);
      const result = await res.json();
      document.getElementById("statResult").textContent = JSON.stringify(result, null, 2);
    }

    async function registerPurchase() {
      const payload = {
        drugName: document.getElementById("inDrug").value,
        quantity: parseInt(document.getElementById("inQty").value),
        unitPrice: parseInt(document.getElementById("inPrice").value),
        purchaseDate: document.getElementById("inDate").value,
        expirationDate: document.getElementById("inExpire").value,
        supplier: document.getElementById("inSupplier").value
      };

      const res = await fetch("/purchases", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const result = await res.json();
      document.getElementById("inResult").textContent = JSON.stringify(result, null, 2);
    }

    async function loadHistory() {
      const name = document.getElementById("histName").value;
      const phone = document.getElementById("histPhone").value;
      const res = await fetch(`/view/patient-history?name=${encodeURIComponent(name)}&phoneLast4=${encodeURIComponent(phone)}`);
      const result = await res.json();
      document.getElementById("histResult").textContent = JSON.stringify(result, null, 2);
    }

    async function cancelOrder() {
      const id = document.getElementById("cancelOrderId").value;
      const res = await fetch(`/delete-od/${id}`, { method: "DELETE" });
      const result = await res.json();
      document.getElementById("cancelResult").textContent = JSON.stringify(result, null, 2);
    }

    async function searchDrug() {
      const keyword = document.getElementById("searchKeyword").value;
      const res = await fetch(`/view/search?keyword=${encodeURIComponent(keyword)}`);
      const result = await res.json();
      document.getElementById("searchResult").textContent = JSON.stringify(result, null, 2);
    }
</script>



</body>
</html>

