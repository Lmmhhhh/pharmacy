<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¼ë°˜ì•½ ì£¼ë¬¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; }
        .low-stock { background-color: #ffe6e6; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="mb-4">ğŸ›’ ì¼ë°˜ì˜ì•½í’ˆ ì£¼ë¬¸</h2>

    <div class="card p-4 shadow-sm">
        <form id="orderForm">
            <div class="row mb-3">
                <div class="col">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" id="name" class="form-control" required>
                </div>
                <div class="col">
                    <label class="form-label">ì „í™”ë²ˆí˜¸ (ë’¤ 4ìë¦¬)</label>
                    <input type="text" id="phoneLast4" class="form-control" required>
                </div>
                <div class="col">
                    <label class="form-label">íŒë§¤ì¼ì</label>
                    <input type="date" id="saleDate" class="form-control" required>
                </div>
            </div>

            <hr>

            <h5>ğŸ’Š ì•½í’ˆ ì¶”ê°€</h5>
            <div class="row g-2 mb-3">
                <div class="col-6">
                    <input type="text" id="drugName" class="form-control" placeholder="ì•½í’ˆëª… ì…ë ¥">
                </div>
                <div class="col-3">
                    <input type="number" id="quantity" class="form-control" value="1" min="1">
                </div>
                <div class="col-3">
                    <button type="button" class="btn btn-primary w-100" onclick="addItem()">â• ì¶”ê°€</button>
                </div>
            </div>

            <table class="table table-bordered" id="itemTable">
                <thead>
                <tr class="table-light">
                    <th>ì•½í’ˆëª…</th>
                    <th>ìˆ˜ëŸ‰</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>

            <div class="d-grid mt-4">
                <button type="button" class="btn btn-success btn-lg" onclick="submitOrder()">âœ… ì£¼ë¬¸ ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

<script>
    const items = [];

    function addItem() {
      const drug = document.getElementById("drugName").value.trim();
      const qty = parseInt(document.getElementById("quantity").value);

      if (!drug || qty < 1) {
        alert("ì•½í’ˆëª…ê³¼ ìˆ˜ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      items.push({ drugName: drug, quantity: qty });

      const row = document.createElement("tr");
      row.innerHTML = `<td>${drug}</td><td>${qty}</td>`;
      document.querySelector("#itemTable tbody").appendChild(row);

      document.getElementById("drugName").value = "";
      document.getElementById("quantity").value = 1;
    }

    async function submitOrder() {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phoneLast4").value;
      const saleDate = document.getElementById("saleDate").value;

      if (!name || !phone || !saleDate || items.length === 0) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ê³  ì•½í’ˆì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
        return;
      }

      const payload = {
        name: name,
        phoneLast4: phone,
        saleDate: saleDate,
        items: items
      };

      try {
        const res = await fetch("/orders/otc", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const err = await res.text();
          throw new Error(err);
        }

        const result = await res.json();
        alert("âœ… ì£¼ë¬¸ ì™„ë£Œ\n" + result.message);
        location.reload();
      } catch (err) {
        alert("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
      }
    }
</script>

</body>
</html>

